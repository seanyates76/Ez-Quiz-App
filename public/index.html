<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EZ Quiz</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="stylesheet" href="styles.css?v=1.1.9" />
</head>
<body data-theme="dark">
  <header class="site-header" role="banner">
    <div class="brand">
      <a href="/" class="brand-link" aria-label="EZ Quiz Home">
        <!-- Use a transparent placeholder at start; JS sets the theme-specific logo -->
        <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" alt="EZ Quiz" class="brand-logo" />
      </a>
    </div>
    <nav class="header-actions" aria-label="Utility">
      <button id="helpBtn" class="icon-btn" title="Help" aria-haspopup="dialog" aria-controls="helpModal">?</button>
      <button id="settingsBtn" class="icon-btn" title="Settings" aria-haspopup="dialog" aria-controls="settingsModal">⚙</button>
    </nav>
  </header>

  <main class="container" id="app" role="main">
    <!-- Generator Card -->
    <section id="generatorCard" class="card">
      <div id="updateBanner" class="update-banner hidden" role="status" aria-live="polite">
        <span>Update available. Refresh to apply.</span>
        <span class="flex-spacer"></span>
        <button id="updateRefreshBtn" class="btn primary" type="button">Refresh</button>
      </div>

      <!-- Top toolbar (simple generate form) -->
      <div class="gen-toolbar" role="group" aria-label="Generate toolbar">
        <input id="topicInput" type="text" class="toolbar-input" placeholder="Topic (e.g. Animals)" />
        <input id="countInput" type="number" class="toolbar-input narrow" min="1" step="1" value="10" />
        <select id="difficultyInput" class="toolbar-input narrow" aria-label="Difficulty">
          <option value="easy">Easy</option>
          <option value="medium" selected>Medium</option>
          <option value="hard">Hard</option>
        </select>
        <button id="generateBtn" class="btn primary">Generate</button>
        <button id="optionsBtn" class="btn" aria-haspopup="true" aria-expanded="false" aria-controls="optionsPanel">Options ▾</button>
      </div>

      <!-- Options Drop-Down (includes Advanced) -->
      <div id="optionsPanel" class="options-panel" role="region" aria-label="Options" hidden>
        <div class="options-regular">
          <div class="row gap wrap">
            <label class="opt-switch"><input type="checkbox" id="optTimerEnabled" /> <span>Timer</span></label>
            <label class="opt-switch"><input type="checkbox" id="optCountdownMode" /> <span>Countdown</span></label>
            <label class="inline small-field">Duration (mm:ss)
              <input type="text" id="optTimerDuration" inputmode="numeric" placeholder="05:00" />
            </label>
          </div>
          <div class="row gap wrap" style="margin-top:8px">
            <span class="lbl">Theme</span>
            <label><input type="radio" name="optTheme" value="dark" /> Dark</label>
            <label><input type="radio" name="optTheme" value="light" /> Light</label>
          </div>
          <div class="row gap wrap" style="margin-top:8px">
            <span class="lbl">Question Types</span>
            <label><input type="checkbox" id="qtMC" checked /> MC</label>
            <label><input type="checkbox" id="qtTF" checked /> TF</label>
            <label><input type="checkbox" id="qtYN" checked /> YN</label>
            <label><input type="checkbox" id="qtMT" checked /> MT</label>
          </div>
          <div class="row gap" style="margin-top:8px">
            <label class="opt-switch"><input type="checkbox" id="optSaveDefault" /> <span>Save as default</span></label>
            <button id="resetDefaultsBtn" class="btn btn-ghost" type="button">Reset defaults</button>
            <span class="muted small">Settings auto‑save as you change them.</span>
          </div>
        </div>
        <div class="divider" role="separator" aria-orientation="horizontal"></div>
        <div class="advanced-disclosure" role="button" tabindex="0" aria-expanded="false" aria-controls="advancedBlock">
          <span>Advanced Editor</span>
          <span class="caret" aria-hidden="true">▼</span>
        </div>
        <div id="advancedBlock" class="advanced-body" hidden>
          <div class="adv-head">
            <h5 class="adv-title">Prompt Editor</h5>
            <div class="adv-title-right">
              <h5 class="adv-title">Debug / Mirror</h5>
              <label class="opt-switch small"><input type="checkbox" id="mirrorToggle" /> <span>Show</span></label>
            </div>
          </div>
          <div class="adv-panels">
            <div class="adv-left">
              <textarea id="editor" class="editor" rows="12" placeholder="MC|Question?|A) 1;B) 2|A&#10;TF|Statement.|T&#10;YN|Question?|Y&#10;MT|Match.|1) L1;2) L2|A) R1;B) R2|1-A,2-B"></textarea>
            </div>
            <div class="adv-right">
              <div id="mirrorBox" class="mirror-box" data-on="false">
                <textarea id="mirror" class="mirror" rows="12" readonly></textarea>
              </div>
            </div>
          </div>
          <div class="adv-actions">
            <div class="row gap">
              <button id="loadBtn" class="btn">Load .txt</button>
              <input id="fileInput" type="file" accept=".txt" style="display:none" />
              <button id="demoBtn" class="btn">Use Demo Set</button>
              <button id="clearBtn" class="btn">Clear</button>
              <button id="loadLastBtn" class="btn">Load last quiz</button>
            </div>
            <div class="row gap">
              <button id="startBtn" class="btn" disabled>Start</button>
            </div>
            <div class="advanced-actions">
              <button id="copyPromptsBtn" class="btn btn-ghost">Copy prompts</button>
              <button id="exportTxtBtn" class="btn btn-ghost">Export .txt</button>
            </div>
          </div>
          <details class="parser-ref" style="margin-top:8px">
            <summary>Parser reference</summary>
            <ul>
              <li><code>MC|Question?|A) 1;B) 2|A</code> (multiple: <code>A,C</code>)</li>
              <li><code>TF|Statement.|T</code></li>
              <li><code>YN|Question?|Y</code></li>
              <li><code>MT|Prompt.|1) L1;2) L2|A) R1;B) R2|1-A,2-B</code></li>
            </ul>
          </details>
          <p style="margin-top:8px">Optional power tools live here. (Prompt Builder ✨ in header.)</p>
        </div>
      </div>
    </section>

    <!-- Quiz View -->
    <section id="quizView" class="card is-hidden" aria-labelledby="quizTitle">
      <div class="quiz-title-row">
        <h2 id="quizTitle">Quiz</h2>
        <button id="backDuringQuiz" class="btn" type="button" title="Back to Menu">Back to Menu</button>
      </div>
      <div class="quiz-header-row">
        <div id="timer" class="timer" aria-live="polite"></div>
      </div>
      <div id="questionHost"></div>
      <div class="row gap quiz-nav-row">
        <button id="prevBtn" class="btn">Previous</button>
        <button id="nextBtn" class="btn success">Next</button>
        <button id="finishBtn" class="btn primary">Finish</button>
      </div>
    </section>

    <!-- Results View -->
    <section id="resultsView" class="card is-hidden" aria-labelledby="resultsTitle">
      <div class="results-header-row">
        <div class="results-header-left">
          <h2 id="resultsTitle">Results</h2>
          <span id="resultsChip" class="chip" aria-live="polite"></span>
        </div>
        <div class="results-filter" role="group" aria-label="Results filter">
          <button id="filterMissed" class="chip-btn active" aria-pressed="true">Missed</button>
          <button id="filterAll" class="chip-btn" aria-pressed="false">All</button>
        </div>
      </div>
      <div id="resultsSummary" class="results-summary"></div>
      <div id="missedList" class="results-missed"></div>
      <div class="row gap results-actions">
        <button id="backToMenuBtn" class="btn">Back to Menu</button>
        <span class="flex-spacer"></span>
        <div id="retakeControl" class="retake-control" role="group" aria-label="Retake options">
          <button id="retakePrimary"
                  class="btn brand retake-primary"
                  type="button"
                  aria-label="Retake selected">
            <span class="retake-label" id="retakeLabel">Retake: Missed</span>
          </button>

          <span class="retake-sep" aria-hidden="true">|</span>

          <button id="retakeCaret"
                  class="btn btn-ghost retake-caret"
                  type="button"
                  aria-haspopup="menu"
                  aria-expanded="false"
                  aria-label="Change retake scope">
            ▾
          </button>

          <div id="retakeMenu"
               class="retake-menu hidden"
               role="menu"
               aria-labelledby="retakeCaret">
            <button class="retake-menu-item"
                    id="retakeSwitch"
                    role="menuitem"
                    type="button">Retake All</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer: Support links -->
  <footer class="container" role="contentinfo">
    <nav aria-label="Footer">
      <p style="margin:12px 0; color:var(--muted)">
        <a href="/CHANGELOG.md" target="_blank" rel="noopener">v1.2.0-beta.4</a>
        &nbsp;•&nbsp;
        <a href="/privacy.html" target="_blank" rel="noopener">Privacy</a>
        &nbsp;•&nbsp;
        <a href="/terms.html" target="_blank" rel="noopener">Terms</a>
      </p>
    </nav>
  </footer>

  

  <!-- Veil Loader -->
  <div id="veil" class="veil" hidden aria-live="polite" aria-busy="true">
    <div class="veil__panel">
      <div class="spinner" aria-hidden="true"></div>
      <div id="veilMsg" class="veil__msg">Loading…</div>
    </div>
  </div>

  <!-- Help Modal (filled FAQ) -->
  <div id="helpModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="helpTitle" aria-hidden="true">
    <div class="modal__backdrop" data-close="helpModal"></div>
    <div class="modal__dialog" role="document">
      <header class="modal__header">
        <h3 id="helpTitle">Help</h3>
        <button id="helpClose" class="icon-btn" title="Close">✕</button>
      </header>
      <div class="modal__body">
        <section>
          <h4>Getting Started</h4>
          <ul>
            <li>Enter a topic in the <em>Topic</em> field, set Length and Difficulty.</li>
            <li>Click <strong>Start</strong> to generate and begin the quiz, or open <strong>Options</strong> for more controls.</li>
          </ul>
        </section>

        <section>
          <h4>Generate vs Start</h4>
          <ul>
            <li><strong>Start</strong> (default): generates → parses → starts the quiz.</li>
            <li><strong>Generate</strong> (Options → Advanced Editor open): fills the <em>Editor</em> and <em>Mirror</em> only; the quiz starts when you click <strong>Start</strong>.</li>
            <li>Re‑using <strong>Generate</strong> clears the editor and creates a fresh set.</li>
          </ul>
        </section>

        <section>
          <h4>Options &amp; Advanced</h4>
          <ul>
            <li>Options: Timer, Theme, Question Types, and Defaults.</li>
            <li><strong>Advanced Editor</strong>: <strong>Editor</strong> (paste or load .txt), <strong>Mirror</strong> (raw lines), <strong>Copy prompts</strong>, <strong>Export .txt</strong>.</li>
            <li>Supported types: Multiple Choice (single/multiple), True/False, Yes/No, Matching.</li>
          </ul>
        </section>

        <section>
          <h4>Defaults</h4>
          <ul>
            <li><strong>Save as default</strong> stores your Count, Difficulty, and Types for next time.</li>
            <li>Use <strong>Reset defaults</strong> to clear saved generation defaults.</li>
          </ul>
        </section>

        <section>
          <h4>Timer &amp; Settings</h4>
          <ul>
            <li>Stopwatch or Countdown (mm:ss) in Settings; preferences persist locally.</li>
            <li>Optional: Require answer to advance; Auto‑start after generate (Start mode only).</li>
          </ul>
        </section>

        <section>
          <h4>Taking Quizzes</h4>
          <ul>
            <li>Navigation: Enter/Right = Next; Backspace/Left = Previous.</li>
            <li>Answers: MC (A–D or 1–4), True/False (T/F), Yes/No (Y/N).</li>
          </ul>
        </section>

        <section>
          <h4>Results &amp; Retakes</h4>
          <ul>
            <li>Results show score, time, and Missed/All (Missed first by default).</li>
            <li>Retake missed only: use the caret next to <em>Retake</em>.</li>
          </ul>
        </section>

        <section>
          <h4>AI Generation</h4>
          <ul>
            <li>Generate sends Topic, Length, Difficulty, and selected types to the AI.</li>
            <li>If nothing returns, try again shortly (rate limits), use Demo Set, or paste lines into the editor.</li>
          </ul>
        </section>

        <!-- Stacked accordions at bottom: What's New, FAQ, Parser Reference -->
        <section>
          <details class="help-accordion">
            <summary>What's New</summary>
            <ul>
              <li><strong>Start vs Generate:</strong> Start runs the quiz; Generate fills Editor + Mirror.</li>
              <li><strong>Options panel:</strong> Timer, Theme, Types, and Advanced tools in one place.</li>
              <li><strong>Advanced:</strong> Editor, Mirror, Copy prompts, Export .txt.</li>
              <li><strong>Defaults:</strong> Save Count/Difficulty/Types; Reset defaults clears them.</li>
              <li><strong>Navigation polish:</strong> Equal-width fields on mobile; clearer focus.</li>
            </ul>
          </details>
        </section>

        <section>
          <details class="help-accordion">
            <summary>FAQ</summary>
            <ul>
              <li><strong>Why is the Start button disabled?</strong> <em>Answer:</em> No valid questions have been parsed yet. Click Generate (with Advanced open), use Demo, or paste valid lines into the Editor, then press Start.</li>
              <li><strong>Why didn't the Generate button start my quiz?</strong> <em>Answer:</em> Either press <strong>Start</strong> in the Advanced Editor, or close Advanced and click <em>Start</em> in the creation bar.</li>
              <li><strong>Why did AI return no lines for my topic?</strong> <em>Answer:</em> This is often a temporary rate limit. Wait ~30 seconds and try again, or reduce Length and simplify the topic; Demo/Editor are reliable backups.</li>
              <li><strong>Why is my Mirror empty or hidden?</strong> <em>Answer:</em> The Mirror appears after content exists. Generate or Load .txt, and ensure the mirror toggle in Advanced is on.</li>
              <li><strong>Why does the Options panel keep closing?</strong> <em>Answer:</em> It closes on outside clicks by design. Clicking inside Topic, Length, or Difficulty will not close it; reopen Options if it collapses.</li>
              <li><strong>Why isn’t my timer showing?</strong> <em>Answer:</em> Enable Timer in Settings; for countdown, set a mm:ss duration. The timer pauses while modals are open and resumes when they close.</li>
              <li><strong>Why aren’t my defaults applied?</strong> <em>Answer:</em> Save as default stores Count, Difficulty, and Types. If values look off, use Reset defaults, save again, and reopen Options.</li>
            </ul>
          </details>
        </section>

        <section>
          <details class="help-accordion">
            <summary>Parser Reference</summary>
            <ul>
              <li><code>MC|Question?|A) Opt1;B) Opt2;C) Opt3;D) Opt4|A</code> (multiple: <code>A,C</code>)</li>
              <li><code>TF|Statement.|T</code> (or <code>F</code>)</li>
              <li><code>YN|Question?|Y</code> (or <code>N</code>)</li>
              <li><code>MT|Prompt.|1) L1;2) L2|A) R1;B) R2|1-A,2-B</code></li>
            </ul>
            <p>Use the exact delimiters shown: pipes <code>|</code>, semicolons <code>;</code>, and labels like <code>A)</code> or <code>1)</code>.</p>
          </details>
        </section>

        <div class="row" style="justify-content:flex-end; margin-top:8px">
          <button id="helpBackToTop" class="btn btn-ghost" type="button">Back to top</button>
        </div>
      </div>
      <footer class="modal__footer">
        <button id="helpOk" class="btn">Close</button>
      </footer>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" aria-hidden="true">
    <div class="modal__backdrop" data-close="settingsModal"></div>
    <div class="modal__dialog" role="document">
      <header class="modal__header">
        <h3 id="settingsTitle">Settings</h3>
        <button id="settingsClose" class="icon-btn" title="Close">✕</button>
      </header>
      <div class="modal__body">
        <fieldset class="fieldgroup">
          <legend>Timer</legend>
          <label><input type="checkbox" id="timerEnabled" /> Enable timer</label>
          <label><input type="checkbox" id="countdownMode" /> Countdown mode</label>
          <label class="inline">
            Duration (mm:ss)
            <input type="text" id="timerDuration" inputmode="numeric" placeholder="05:00" />
          </label>
        </fieldset>

        <fieldset class="fieldgroup">
          <legend>Quiz Behavior</legend>
          <label><input type="checkbox" id="autoStart" /> Auto‑start after generate</label>
          <label><input type="checkbox" id="requireAnswer" /> Require answer to advance</label>
        </fieldset>

        <fieldset class="fieldgroup">
          <legend>Appearance</legend>
          <label><input type="radio" name="theme" value="dark" checked /> Dark</label>
          <label><input type="radio" name="theme" value="light" /> Light</label>
        </fieldset>

        <fieldset class="fieldgroup">
          <legend>Advanced</legend>
          <label><input type="checkbox" id="alwaysShowAdvanced" /> Always show advanced options</label>
        </fieldset>


        <div class="row">
          <button id="resetApp" class="btn danger">Reset App</button>
        </div>
        <div class="row" style="justify-content:flex-end; margin-top:8px">
          <label class="muted small"><input type="checkbox" checked disabled /> Beta version</label>
        </div>
      </div>
      <footer class="modal__footer">
        <button class="btn" id="settingsSave">Close</button>
      </footer>
    </div>
  </div>

  

  <script type="module" src="js/main.js?v=1.1.9"></script>
  <script type="module" src="js/auto-refresh.js?v=1.1.9"></script>

  <!-- Floating actions: Feedback + Coffee -->
  <div id="floatingActions" class="fab-stack" aria-label="Quick actions">
    <a
      id="feedbackFab"
      class="fab"
      href="#feedback"
      aria-label="Open feedback panel"
      title="Send Feedback"
    >
      💬
      <span class="fab-label">Feedback</span>
    </a>
    <!-- Support link kept as fallback; auto-hidden if official BMC widget is present -->
    <a
      id="coffeeFab"
      class="fab"
      href="https://buymeacoffee.com/seanyates78"
      target="_blank"
      rel="noopener"
      aria-label="Buy Me a Coffee"
      title="Buy Me a Coffee"
    >
      ☕
      <span class="fab-label">Support</span>
    </a>
  </div>

  <!-- Inline Feedback Panel -->
  <div id="feedbackPanel" class="fab-panel hidden" role="dialog" aria-modal="true" aria-labelledby="feedbackTitle">
    <h2 id="feedbackTitle" class="sr-only">Send feedback</h2>
    <div class="fab-panel__row">
      <textarea id="feedbackMessage" class="fab-input" rows="4" maxlength="500" placeholder="Your feedback (required)" aria-label="Feedback message"></textarea>
    </div>
    <!-- Honeypot for spam bots: hidden field should remain empty -->
    <input id="feedbackTrap" class="sr-only" type="text" tabindex="-1" autocomplete="off" aria-hidden="true" />
    <div class="fab-panel__row">
      <input id="feedbackEmail" class="fab-input" type="email" placeholder="Email (optional)" aria-label="Your email (optional)" />
    </div>
    <div class="fab-panel__row" style="align-items:center">
      <span id="feedbackCount" class="muted small">0/500</span>
      <span class="flex-spacer"></span>
      <button id="feedbackCancel" class="btn" type="button">Cancel</button>
      <button id="feedbackSend" class="btn primary" type="button">Send</button>
    </div>
    <div id="feedbackStatus" class="status" aria-live="polite"></div>
  </div>
</body>
</html>
