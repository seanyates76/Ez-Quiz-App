<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EZ Quiz</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body data-theme="dark">
  <header class="site-header" role="banner">
    <div class="brand">
      <a href="/" class="brand-link" aria-label="EZ Quiz Home">
        <img src="icons/brand-title-source.png" alt="EZ Quiz" class="brand-logo" />
      </a>
    </div>
    <nav class="header-actions" aria-label="Utility">
      <button id="helpBtn" class="icon-btn" title="Help" aria-haspopup="dialog" aria-controls="helpModal">?</button>
      <button id="settingsBtn" class="icon-btn" title="Settings" aria-haspopup="dialog" aria-controls="settingsModal">⚙</button>
      <button id="promptBtn" class="icon-btn" title="Prompt Builder" aria-haspopup="dialog" aria-controls="promptModal">✨</button>
    </nav>
  </header>

  <main class="container" id="app" role="main">
    <!-- Generator Card -->
    <section id="generatorCard" class="card">

      <!-- Top toolbar (simple generate form) -->
      <div class="gen-toolbar" role="group" aria-label="Generate toolbar">
        <input id="topicInput" type="text" class="toolbar-input" placeholder="Topic (e.g., World History)" />
        <input id="countInput" type="number" class="toolbar-input narrow" min="1" step="1" value="10" />
        <select id="difficultyInput" class="toolbar-input narrow" aria-label="Difficulty">
          <option value="easy">Easy</option>
          <option value="medium" selected>Medium</option>
          <option value="hard">Hard</option>
        </select>
        <button id="generateBtn" class="btn primary">Generate</button>
        <button id="advancedToggleBtn" class="btn">Advanced ▾</button>
      </div>

      <!-- Advanced authoring (manual paste + preview) -->
      <details id="manualMenu" class="advanced">
        <summary>Advanced</summary>
        <div class="advanced-body">
          <div class="grid">
            <div class="col">
              <label for="editor" class="lbl">Editor (paste MC/TF/YN/MT lines)</label>
              <textarea id="editor" class="editor" rows="10" placeholder="MC|Question?|A) 1;B) 2|A&#10;TF|Statement.|T&#10;YN|Question?|Y&#10;MT|Match.|1) L1;2) L2|A) R1;B) R2|1-A,2-B"></textarea>
              <div id="status" class="status" aria-live="polite"></div>
              <div class="row gap" style="margin-top:8px">
                <button id="loadBtn" class="btn">Load .txt</button>
                <input id="fileInput" type="file" accept=".txt" style="display:none" />
                <button id="demoBtn" class="btn">Use Demo Set</button>
                <button id="clearBtn" class="btn">Clear</button>
              </div>
            </div>

            <div class="col">
              <label for="mirror" class="lbl">Mirror</label>
              <textarea id="mirror" class="mirror" rows="10" readonly></textarea>
              <div class="row gap">
                <button id="startBtn" class="btn" disabled>Start</button>
              </div>
            </div>
          </div>
          <p style="margin-top:8px">Optional power tools live here. (Prompt Builder ✨ in header.)</p>
        </div>
      </details>
    </section>

    <!-- Quiz View -->
    <section id="quizView" class="card is-hidden" aria-labelledby="quizTitle">
      <div class="quiz-title-row">
        <h2 id="quizTitle">Quiz</h2>
        <button id="backDuringQuiz" class="btn" type="button" title="Back to Menu">Back to Menu</button>
      </div>
      <div class="quiz-header-row">
        <div id="timer" class="timer" aria-live="polite"></div>
      </div>
      <div id="questionHost"></div>
      <div class="row gap quiz-nav-row">
        <button id="prevBtn" class="btn">Previous</button>
        <button id="nextBtn" class="btn success">Next</button>
        <button id="finishBtn" class="btn primary">Finish</button>
      </div>
    </section>

    <!-- Results View -->
    <section id="resultsView" class="card is-hidden" aria-labelledby="resultsTitle">
      <div class="results-header-row">
        <h2 id="resultsTitle">Results</h2>
        <label class="inline"><input type="checkbox" id="showAllChk"> Show all</label>
      </div>
      <div id="resultsSummary" class="results-summary"></div>
      <div id="missedList" class="results-missed"></div>
      <div class="row gap results-actions">
        <button id="backToMenuBtn" class="btn">Back to Menu</button>
        <span class="flex-spacer"></span>
        <div class="split">
          <button id="retakeBtn" class="btn">Retake</button>
          <button id="retakeMenuBtn" class="btn split-caret" aria-haspopup="menu" aria-expanded="false" title="More retake options">▾</button>
          <div id="retakeMenu" class="menu" role="menu" hidden>
            <button id="retakeMissedBtn" class="menu-item" role="menuitem">Take missed quiz</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer: Support links -->
  <footer class="container" role="contentinfo">
    <nav aria-label="Footer">
      <p style="margin:12px 0; color:var(--muted)">
        <a href="https://www.buymeacoffee.com/seanyates78" target="_blank" rel="noopener">Support</a>
        &nbsp;•&nbsp;
        <a href="/privacy.html" target="_blank" rel="noopener">Privacy</a>
        &nbsp;•&nbsp;
        <a href="/terms.html" target="_blank" rel="noopener">Terms</a>
      </p>
    </nav>
  </footer>

  <!-- Floating Support (fallback) -->
  <a id="bmacBtn" class="bmac" href="https://www.buymeacoffee.com/seanyates78" target="_blank" rel="noopener">☕</a>

  <!-- Veil Loader -->
  <div id="veil" class="veil" hidden aria-live="polite" aria-busy="true">
    <div class="veil__panel">
      <div class="spinner" aria-hidden="true"></div>
      <div id="veilMsg" class="veil__msg">Loading…</div>
    </div>
  </div>

  <!-- Help Modal (filled FAQ) -->
  <div id="helpModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="helpTitle" aria-hidden="true">
    <div class="modal__backdrop" data-close="helpModal"></div>
    <div class="modal__dialog" role="document">
      <header class="modal__header">
        <h3 id="helpTitle">Help</h3>
        <button id="helpClose" class="icon-btn" title="Close">✕</button>
      </header>
      <div class="modal__body">
        <section>
          <h4>Make a Quiz (Fast)</h4>
          <ol>
            <li>Type a <strong>Topic</strong> at the top.</li>
            <li>Pick a <strong>Length</strong> and <strong>Difficulty</strong>.</li>
            <li>Click <strong>Generate</strong>, then <strong>Start</strong>.</li>
          </ol>
          <p>Tip: Want to try it first? Click <strong>Use Demo Set</strong>.</p>
        </section>

        <section>
          <h4>Answering Questions</h4>
          <ul>
            <li><strong>Multiple choice</strong>: click one or more options (some questions have multiple correct answers).</li>
            <li><strong>True/False</strong> and <strong>Yes/No</strong>: use the on‑screen buttons or keys (<kbd>T/F</kbd>, <kbd>Y/N</kbd>).</li>
            <li><strong>Keyboard</strong>: <kbd>Enter</kbd>/<kbd>→</kbd> for Next, <kbd>Backspace</kbd>/<kbd>←</kbd> for Previous.</li>
          </ul>
        </section>

        <section>
          <h4>Results &amp; Retake</h4>
          <ul>
            <li>See your score and time; missed questions show first by default.</li>
            <li>Toggle <strong>Show all</strong> to list everything (missed items stay highlighted).</li>
            <li>Use <strong>Retake</strong> or the menu caret to <strong>Retake missed only</strong>.</li>
          </ul>
        </section>

        <section>
          <h4>Timer &amp; Preferences</h4>
          <ul>
            <li>Open <strong>Settings</strong> to enable a timer (Stopwatch or Countdown).</li>
            <li>Set countdown as <code>mm:ss</code>. Options like <strong>Auto‑start</strong> and <strong>Require answer</strong> are available.</li>
            <li>Theme and preferences save automatically; use <strong>Reset App</strong> to clear them.</li>
          </ul>
        </section>

        <section>
          <h4>Manual Entry (Optional)</h4>
          <p>Prefer to paste your own questions? Use the <strong>Editor</strong> under <em>Advanced</em>, then click <strong>Generate</strong> → <strong>Start</strong>.</p>
          <details>
            <summary>Formats at a glance</summary>
            <ul>
              <li><code>MC|Question?|A) Opt1;B) Opt2;C) Opt3;D) Opt4|A</code> (multiple: <code>|A,C</code>)</li>
              <li><code>TF|Statement.|T</code> (or <code>F</code>)</li>
              <li><code>YN|Question?|Y</code> (or <code>N</code>)</li>
              <li><code>MT|Prompt.|1) L1;2) L2|A) R1;B) R2|1-A,2-B</code></li>
            </ul>
            <p>Use the exact delimiters shown: pipes <code>|</code>, semicolons <code>;</code>, and labels like <code>A)</code> or <code>1)</code>.</p>
          </details>
        </section>

        <section>
          <h4>Advanced</h4>
          <ul>
            <li><strong>Prompt Builder ✨</strong>: enter a Topic and Length, then <strong>Copy</strong> a ready‑made prompt for your AI tool; paste the generated lines into the Editor.</li>
            <li><strong>Generate from Topic</strong>: when available, the <strong>Generate</strong> button can create quiz lines for you; otherwise, paste lines or use the Demo.</li>
          </ul>
        </section>

        <section>
          <h4>Troubleshooting</h4>
          <ul>
            <li><strong>Generate isn’t producing questions?</strong> Try the <strong>Demo</strong>, or paste questions into the Editor and click <strong>Generate</strong>.</li>
            <li><strong>Start is disabled?</strong> Make sure at least one valid question is parsed (check the status message under the Editor).</li>
            <li><strong>Timer not visible?</strong> Enable it in Settings and set a duration for countdown.</li>
            <li><strong>Need a fresh start?</strong> Use <strong>Reset App</strong> in Settings.</li>
          </ul>
        </section>

        <section>
          <h4>FAQs</h4>
          <ul>
            <li><strong>Can I retake only missed questions?</strong> Yes — open Results and use the caret next to Retake.</li>
            <li><strong>Does it work offline?</strong> Yes. It’s a PWA; once loaded, it works without internet.</li>
            <li><strong>Where do my settings go?</strong> Theme and timer preferences are saved locally in your browser.</li>
            <li><strong>How do I import my own quiz?</strong> Click Load .txt or paste lines into the Editor under Advanced, then Generate → Start.</li>
            <li><strong>Which question types are supported?</strong> Multiple choice (single/multiple), True/False, Yes/No, and Matching.</li>
          </ul>
        </section>
      </div>
      <footer class="modal__footer">
        <button id="helpOk" class="btn">Close</button>
      </footer>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" aria-hidden="true">
    <div class="modal__backdrop" data-close="settingsModal"></div>
    <div class="modal__dialog" role="document">
      <header class="modal__header">
        <h3 id="settingsTitle">Settings</h3>
        <button id="settingsClose" class="icon-btn" title="Close">✕</button>
      </header>
      <div class="modal__body">
        <fieldset class="fieldgroup">
          <legend>Timer</legend>
          <label><input type="checkbox" id="timerEnabled" /> Enable timer</label>
          <label><input type="checkbox" id="countdownMode" /> Countdown mode</label>
          <label class="inline">
            Duration (mm:ss)
            <input type="text" id="timerDuration" inputmode="numeric" placeholder="05:00" />
          </label>
        </fieldset>

        <fieldset class="fieldgroup">
          <legend>Quiz Behavior</legend>
          <label><input type="checkbox" id="autoStart" /> Auto‑start after generate</label>
          <label><input type="checkbox" id="requireAnswer" /> Require answer to advance</label>
        </fieldset>

        <fieldset class="fieldgroup">
          <legend>Appearance</legend>
          <label><input type="radio" name="theme" value="dark" checked /> Dark</label>
          <label><input type="radio" name="theme" value="light" /> Light</label>
        </fieldset>

        <div class="row">
          <button id="resetApp" class="btn danger">Reset App</button>
        </div>
      </div>
      <footer class="modal__footer">
        <button class="btn" id="settingsSave">Close</button>
      </footer>
    </div>
  </div>

  <!-- Prompt Builder Modal -->
  <div id="promptModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="promptTitle" aria-hidden="true">
    <div class="modal__backdrop" data-close="promptModal"></div>
    <div class="modal__dialog" role="document">
      <header class="modal__header">
        <h3 id="promptTitle">Prompt Builder ✨</h3>
        <button id="promptClose" class="icon-btn" title="Close">✕</button>
      </header>
      <div class="modal__body">
        <label class="block">Topic <input id="pbTopic" type="text" placeholder="CompTIA A+ 2025 Core 1" /></label>
        <label class="block">Length <input id="pbCount" type="number" min="1" step="1" value="30" /></label>
      </div>
      <footer class="modal__footer">
        <button id="pbCancel" class="btn">Cancel</button>
        <button id="pbCopy" class="btn primary">Copy Prompt</button>
      </footer>
    </div>
  </div>

  <script type="module" src="js/main.js"></script>
  <!-- Buy Me a Coffee widget: use official snippet on desktop, fallback ☕ on mobile/tablet -->
  <script>
    (function(){
      var mq = window.matchMedia('(min-width: 768px)');
      var WIDGET_SRC = 'https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js';

      function getWidgetIframe(){
        return document.querySelector('iframe[src*="buymeacoffee.com"]');
      }
      function getWidgetScript(){
        return document.querySelector('script[src="'+WIDGET_SRC+'"]');
      }
      function show(el){ if(el) el.style.display = ''; }
      function hide(el){ if(el) el.style.display = 'none'; }

      function syncSupportUI(){
        var btn = document.getElementById('bmacBtn');
        var iframe = getWidgetIframe();
        if(mq.matches){
          if(iframe){ hide(btn); show(iframe); }
          else { show(btn); }
        } else {
          if(iframe){ hide(iframe); }
          show(btn);
        }
      }

      function injectOfficialSnippet(){
        if(!mq.matches) return; // desktop only
        if(getWidgetScript()) { syncSupportUI(); return; }
        var s = document.createElement('script');
        s.src = WIDGET_SRC;
        s.setAttribute('data-name','BMC-Widget');
        s.setAttribute('data-cfasync','false');
        s.setAttribute('data-id','seanyates78');
        s.setAttribute('data-description','Support me on Buy me a coffee!');
        s.setAttribute('data-message','Want to support the developer? Buy me a coffee here! :)');
        s.setAttribute('data-color','#5F7FFF');
        s.setAttribute('data-position','Right');
        s.setAttribute('data-x_margin','18');
        s.setAttribute('data-y_margin','18');
        s.onload = syncSupportUI;
        (document.body || document.head).appendChild(s);
      }

      window.addEventListener('load', function(){ setTimeout(function(){ injectOfficialSnippet(); syncSupportUI(); }, 200); });

      var mo = new MutationObserver(syncSupportUI);
      mo.observe(document.documentElement, { childList:true, subtree:true });

      if(typeof mq.addEventListener === 'function'){
        mq.addEventListener('change', function(){ injectOfficialSnippet(); syncSupportUI(); });
      } else if(typeof mq.addListener === 'function'){
        mq.addListener(function(){ injectOfficialSnippet(); syncSupportUI(); });
      }
    })();
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(() => {});
      });
    }
  </script>
</body>
</html>
